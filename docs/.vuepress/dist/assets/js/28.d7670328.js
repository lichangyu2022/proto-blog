(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{511:function(s,e,n){"use strict";n.r(e);var a=n(31),t=Object(a.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"_1-virtualbox-environment"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-virtualbox-environment"}},[s._v("#")]),s._v(" 1.VirtualBox environment")]),s._v(" "),n("ol",[n("li",[s._v("Vbox version>5.2")]),s._v(" "),n("li",[s._v("创建虚拟机:\n"),n("ul",[n("li",[s._v("Cpu>2")]),s._v(" "),n("li",[s._v("Memory>4G")]),s._v(" "),n("li",[s._v("Network card : 2")])])]),s._v(" "),n("li",[s._v("两个网卡\n"),n("ul",[n("li",[s._v("第一个是 NAT enp0s3，用来上网")]),s._v(" "),n("li",[s._v("第二个连接本地，k8s 使用 enp0s8, Host-only。")])])]),s._v(" "),n("li",[s._v("启动虚拟机")])]),s._v(" "),n("hr"),s._v(" "),n("h1",{attrs:{id:"_2-centos8-1安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-centos8-1安装"}},[s._v("#")]),s._v(" 2.centos8.1安装")]),s._v(" "),n("ol",[n("li",[s._v("VM configuration\n"),n("ul",[n("li",[s._v("Centos: 8.1.1911")]),s._v(" "),n("li",[s._v("User: root")]),s._v(" "),n("li",[s._v("Pass: 123456")]),s._v(" "),n("li",[s._v("Ip add: 192.168.56.5 主机地址：192.168.56.1")]),s._v(" "),n("li",[s._v("K8s version 1.21.5")])])]),s._v(" "),n("li",[s._v("软件下载\n"),n("ul",[n("li",[s._v("官方链接 "),n("a",{attrs:{href:"https://www.centos.org/download/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.centos.org/download/"),n("OutboundLink")],1)]),s._v(" "),n("li",[s._v("清华大学镜像网站下载 "),n("a",{attrs:{href:"https://mirrors.tuna.tsinghua.edu.cn/centos/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://mirrors.tuna.tsinghua.edu.cn/centos/"),n("OutboundLink")],1)]),s._v(" "),n("li",[s._v("清华大学 centos 镜像"),n("a",{attrs:{href:"https://mirrors.tuna.tsinghua.edu.cn/help/centos/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://mirrors.tuna.tsinghua.edu.cn/help/centos/"),n("OutboundLink")],1)]),s._v(" "),n("li",[s._v("安装 centos8.1")]),s._v(" "),n("li",[s._v("配置网络，时区等信息")]),s._v(" "),n("li",[s._v("安装完成后，使用 xshell 连接")])])]),s._v(" "),n("li",[s._v("添加阿里源\n"),n("ul",[n("li",[s._v("先备份 /etc/yum.repos.d/ 内的文件（CentOS 7 及之前为 CentOS-Base.repo，CentOS 8 为\nCentOS-Linux-*.repo）")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cp /etc/yum.repos.d/*.repo /etc/yum.repos.d/*.repo.bak\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("编 辑 /etc/yum.repos.d/ 中 的 相 应 文 件 ， 在 mirrorlist= 开头行前面加 # 注 释 掉 ； 并\n将 baseurl= 开头行取消注释（如果被注释的话），把该行内的域名（例如 mirror.centos.org）\n替换为 mirrors.tuna.tsinghua.edu.cn")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("sudo sed -e 's|^mirrorlist=|#mirrorlist=|g' \\\n-e\n's|^#baseurl=http://mirror.centos.org|baseurl=https://mirrors.tuna.tsinghua.edu.cn|g' \\\n-i.bak \\\n/etc/yum.repos.d/CentOS-*.repo\n\n注意其中的*通配符，如果只需要替换一些文件中的源，请他妈自行增删。\n注意，如果需要启用其中一些 repo，需要将其中的 enabled=0 改为 enabled=1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ul",[n("li",[s._v("最后，更新软件包缓存")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(" sudo yum makecache\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("修改成阿里源")])]),s._v(" "),n("div",{staticClass:"language-aidl line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(" sed -e 's|^mirrorlist=|#mirrorlist=|g'\\\n -e\n 's|^#baseurl=http://mirrors.tuna.tsinghua.edu.cn|baseurl=https://mirrors.aliyun.com|g' \\\n -i.bak \\\n /etc/yum.repos.d/CentOS-*.repo\n\n\n sed -e 's|^mirrorlist=|#mirrorlist=|g'\\\n -e 's|^#baseurl=http://mirror.centos.org|baseurl=https://mirrors.aliyun.com|g' \\\n -i.bak \\\n /etc/yum.repos.d/CentOS-*.repo\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("ul",[n("li",[s._v("手动修改成阿里源")])]),s._v(" "),n("div",{staticClass:"language-aidl line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(" Copy\n # file: /etc/yum.repos.d/CentOS-AppStream.repo\n [AppStream]\n name=CentOS-$releasever - AppStream\n baseurl=http://mirrors.aliyun.com/centos/$releasever/AppStream/$basearch/os/\n gpgcheck=1\n enabled=1\n gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial\n\n Copy\n # file: /etc/yum.repos.d/CentOS-Base.repo\n [BaseOS]\n name=CentOS-$releasever - Base\n baseurl=http://mirrors.aliyun.com/centos/$releasever/BaseOS/$basearch/os/\n gpgcheck=1\n enabled=1\n gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial\n change network add : 192.168.56.5/24\n change host name: k18-5\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])])])]),s._v(" "),n("h1",{attrs:{id:"_3-环境准备"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-环境准备"}},[s._v("#")]),s._v(" 3.环境准备")]),s._v(" "),n("div",{staticClass:"language-aidl line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cat >> /etc/hosts <<OFF\n192.168.56.5 k18-5\nOFF\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ol",[n("li",[s._v("关闭swap")])]),s._v(" "),n("div",{staticClass:"language-aidl line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("如果不关闭，默认配置的 kubelet 将无法启动\nswapoff -a \nsed -i 's/.*swap.*/#&/' /etc/fstab\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("禁用 SELINUX")])]),s._v(" "),n("div",{staticClass:"language-aidl line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('setenforce 0 \nsed -i "s/^SELINUX=enforcing/SELINUX=disabled/g" /etc/sysconfig/selinux \nsed -i "s/^SELINUX=enforcing/SELINUX=disabled/g" /etc/selinux/config \nsed -i "s/^SELINUX=permissive/SELINUX=disabled/g" /etc/sysconfig/selinux \nsed -i "s/^SELINUX=permissive/SELINUX=disabled/g" /etc/selinux/config\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ol",{attrs:{start:"3"}},[n("li",[s._v("关闭并设置开机关闭查看服务状态")])]),s._v(" "),n("div",{staticClass:"language-aidl line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("systemctl stop firewalld.service\nsystemctl disable firewalld.service\nsystemctl status firewalld.service\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ol",{attrs:{start:"4"}},[n("li",[s._v("创建/etc/sysctl.d/k8s.conf 文件")])]),s._v(" "),n("div",{staticClass:"language-aidl line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cat >>/etc/sysctl.d/k8s.conf<< OFF\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.ipv4.ip_forward = 1\nOFF\n执行如下命令使修改生效：\nmodprobe br_netfilter\nsysctl -p /etc/sysctl.d/k8s.conf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ol",{attrs:{start:"5"}},[n("li",[s._v("加载 ipvs 模块")])]),s._v(" "),n("div",{staticClass:"language-aidl line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("modprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- nf_conntrack_ipv4\nlsmod | grep ip_vs\nlsmod | grep nf_conntrack_ipv4\nyum install -y ipvsadm ipset\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ol",{attrs:{start:"6"}},[n("li",[s._v("/etc/yum.conf yum 设置代理")])]),s._v(" "),n("div",{staticClass:"language-aidl line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cat >> /etc/yum.conf << OFF\nproxy=http://guest.cn.hhh.com:8080\nOFF\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ol",{attrs:{start:"7"}},[n("li",[s._v("/etc/wgetrc Wget 设置代理,内容与上面的相同")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cat >> /etc/wgetrc << OFF\nhttps_proxy=http://guest.cn.hhh.com:8080/\nhttp_proxy=http://guest.cn.hhh.com:8080/\nftp_proxy=http://guest.cn.hhh.com:8080/\nOFF\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ol",{attrs:{start:"8"}},[n("li",[s._v("docker 安装")])]),s._v(" "),n("div",{staticClass:"language-aidl line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('step 1: 安装必要的一些系统工具\nyum install -y yum-utils device-mapper-persistent-data lvm2\n\nStep 2: 设置 stable 镜像 aliyun 仓库\nyum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nyum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n\n更新 yum 软件包索引\nyum makecache fast\n\n查看目前官方仓库的 docker 版本。\nyum list docker-ce.x86_64 --showduplicates |sort -r #从高到低列出 Docker-ce 的版本\nyum remove docker-ce docker-ce-cli containerd.io -y\nyum install docker-ce-20.10.8 docker-ce-cli-20.10.8 containerd.io-1.4.10 -y –-allowerasing\nyum remove podman -y\nsystemctl start docker\nsystemctl enable docker --now\n\n设置 Docker 镜像加速器\n修改 docker 配置以适应 kubelet\nvi /etc/docker/daemon.json \n{\n "registry-mirrors": ["https://registry.cn-hangzhou.aliyuncs.com"],\n "exec-opts": ["native.cgroupdriver=systemd"]\n}\nsystemctl daemon-reload\nsystemctl restart docker\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("ol",{attrs:{start:"9"}},[n("li",[s._v("Kubeadm, Kubelet, Kubectl 安装\nkubeadm 是 kubernetes 的集群安装工具，能够快速安装 kubernetes 集群。能完成下面拓扑安装")])]),s._v(" "),n("ul",[n("li",[s._v("单节点 k8s （1+0）")]),s._v(" "),n("li",[s._v("单 master 和多 node 的 k8s 系统（1+n）")]),s._v(" "),n("li",[s._v("Mater HA 和多 node 的 k8s 系统(m*1+n)\n"),n("img",{attrs:{src:"/image/k8s/kubeadm%E5%9C%A8%E6%95%B4%E4%B8%AAK8S%E6%9E%B6%E6%9E%84%E9%87%8C%E7%9A%84%E4%BD%8D%E7%BD%AE.png",alt:""}})]),s._v(" "),n("li",[s._v("kubeadm init 启动一个 Kubernetes 主节点")]),s._v(" "),n("li",[s._v("kubeadm join 启动一个 Kubernetes 工作节点并且将其加入到集群")]),s._v(" "),n("li",[s._v("kubeadm upgrade 更新一个 Kubernetes 集群到新版本")]),s._v(" "),n("li",[s._v("kubeadm config 如果你使用 kubeadm v1.7.x 或者更低版本，你需要对你的集群做一些\n配置以便使用 kubeadm upgrade 命令")]),s._v(" "),n("li",[s._v("kubeadm token 使用 kubeadm join 来管理令牌， https")]),s._v(" "),n("li",[s._v("kubeadm reset 还原之前使用 kubeadm init 或者 kubeadm join 对节点产生的改\n变")]),s._v(" "),n("li",[s._v("kubeadm version 打印出 kubeadm 版本")]),s._v(" "),n("li",[s._v("kubeadm alpha 预览一组可用的新功能以便从社区搜集反馈")]),s._v(" "),n("li",[s._v("添加软件源信息")])]),s._v(" "),n("div",{staticClass:"language-aidl line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cat <<EOF > /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-\nx86_64/\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg \nhttps://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n\nyum list kubeadm --showduplicates |sort -r\nyum remove kubeadm.x86_64 kubectl.x86_64 kubelet.x86_64 -y\nyum install kubeadm-1.18.3 kubectl-1.18.3 kubelet-1.18.3 -y\nyum install kubeadm kubectl kubelet -y\nyum install kubeadm-1.21.5 kubectl-1.21.5 kubelet-1.21.5 -y\n\n节点对应的位置即可使用 kubectl 命令行工具了\nkubectl version\n\n启动 kubelet\nsystemctl daemon-reload\nsystemctl start kubelet.service\nsystemctl enable kubelet.service\nsystemctl status kubelet.service\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("h1",{attrs:{id:"_4-集群安装-master"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-集群安装-master"}},[s._v("#")]),s._v(" 4:集群安装（Master）")]),s._v(" "),n("ol",[n("li",[s._v("命令行直接安装")])]),s._v(" "),n("div",{staticClass:"language-aidl line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("所有节点安装之前记得先把镜像准备好，否者将无法启动，也不报错。\n--pod-network-cidr=10.10.0.0/16\n--service-cidr=10.20.0.0/16\n--image-repository registry.aliyuncs.com/google_containers\nkubeadm init --image-repository registry.aliyuncs.com/google_containers --\nkubernetes-version=v1.21.5 --pod-network-cidr=10.10.0.0/16 --service-cidr=10.20.0.0/16 --apiserver-advertise-address=192.168.56.5\nTwo VM with below IP address and host name after modification\n192.168.56.5 k18-5 master\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("配置文件安装")])]),s._v(" "),n("div",{staticClass:"language-aidl line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('1. 生成文件\nkubeadm config print init-defaults >init-config.yaml\nkubeadm init --config=init-config.yaml\n2.修改文件\nv init-config.yaml \napiVersion: kubeadm.k8s.io/v1beta3\nbootstrapTokens:\n- groups:\n - system:bootstrappers:kubeadm:default-node-token\n token: abcdef.0123456789abcdef\n ttl: 24h0m0s\n usages:\n- signing\n - authentication\nkind: InitConfiguration\nlocalAPIEndpoint:\n advertiseAddress: 192.168.56.5\n bindPort: 6443\nnodeRegistration:\n criSocket: /var/run/dockershim.sock\n imagePullPolicy: IfNotPresent\n name: node\n taints: null\n---\napiServer:\n timeoutForControlPlane: 4m0s\napiVersion: kubeadm.k8s.io/v1beta3\ncertificatesDir: /etc/kubernetes/pki\nclusterName: kubernetes\ncontrollerManager: {}\ndns: {}\netcd:\n local:\n dataDir: /var/lib/etcd\nimageRepository: registry.aliyuncs.com/google_containers\nkind: ClusterConfiguration\nkubernetesVersion: 1.21.5\nnetworking:\n dnsDomain: cluster.local\n serviceSubnet: 10.20.0.0/16\n podSubnet: "10.10.0.0/16"\nscheduler: {}\n---\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\nmode: "ipvs"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br")])]),n("ol",{attrs:{start:"3"}},[n("li",[s._v("卸载安装")])]),s._v(" "),n("div",{staticClass:"language-aidl line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("使用 flannel 插件\nkubeadm reset\nifconfig cni0 down && ip link delete cni0\nifconfig flannel.1 down && ip link delete flannel.1\nrm -rf /var/lib/cni/\nrm -rf /etc/kubernetes\nrm -rf /root/.kube/config\nrm -rf /var/lib/etcd\nabove is necessary, cnI0 address conflict to setup sandbox.\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("ol",{attrs:{start:"4"}},[n("li",[s._v("Kubectl 准备")])]),s._v(" "),n("div",{staticClass:"language-aidl line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("下面的命令是配置如何使用 kubectl 访问集群的方式：\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n\n状态检查\nKubectl get cs/node/pod\nK get all -A\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ol",{attrs:{start:"5"}},[n("li",[s._v("安装 POD network Flannel")])]),s._v(" "),n("div",{staticClass:"language-aidl line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n如果多个网卡修改增加 arg 下面的参数\nargs:\n- --ip-masq\n- --kube-subnet-mgr\n- --iface=enp0s8\n\nK apply -f kube-flannel.yaml\nkubectl get ds -l app=flannel -n kube-system\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h1",{attrs:{id:"_5-master-node-参与工作负载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-master-node-参与工作负载"}},[s._v("#")]),s._v(" 5.Master node 参与工作负载")]),s._v(" "),n("div",{staticClass:"language-aidl line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('\n使用 kubeadm 初始化的集群， Pod 不会被调度到 Master Node 上，也就是说 Master \nNode 不参与工作负载。这是因为当前的 master 节点 node1 被打上了 node-role.kubernetes.io/master:NoSchedule 的污点：\nkubectl describe node k18-5 | grep Taint\nTaints: node-role.kubernetes.io/master:NoSchedule\n\n因为这里搭建的是测试环境，去掉这个污点使 node1 参与工作负载：\nkubectl taint nodes k18-56 node-role.kubernetes.io/master-k describe configmap kube-proxy -n kube-system\nk edit configmap kube-proxy -n kube-system\nmode: "ipvs"\nk delete pod *1\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h1",{attrs:{id:"_6-node-join"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-node-join"}},[s._v("#")]),s._v(" 6.Node Join")]),s._v(" "),n("div",{staticClass:"language-aidl line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("kubeadm join 192.168.56.5:6443 --token tu4o1w.0h3742iq4w3zhdwz --discovery-tokenca-cert-hash \nsha256:a13d673cbfd7a40b03e93dabdc472dc3a43350034e01eb6dc2abe42322c3354d\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h1",{attrs:{id:"_7-node"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-node"}},[s._v("#")]),s._v(" 7.Node")]),s._v(" "),n("p",[s._v("Kubernetes 通过将容器放入在节点（Node）上运行的 Pod 中来执行你的工作负载。\n节点可以是一个虚拟机或者物理机器，取决于所在的集群配置。 每个节点包含运\n行 Pods 所需的服务； 这些节点由 控制面 负责管理。\n通常集群中会有若干个节点；而在一个学习用或者资源受限的环境中，你的集群中也\n可能 只有一个节点。\n节点上的组件包括 kubelet、 容器运行时以及 kube-proxy。\n节点状态\n一个节点的状态包含以下信息:")]),s._v(" "),n("ul",[n("li",[s._v("地址")]),s._v(" "),n("li",[s._v("状况")]),s._v(" "),n("li",[s._v("容量与可分配")]),s._v(" "),n("li",[s._v("信息\n你可以使用 kubectl 来查看节点状态和其他细节信息：\n"),n("code",[s._v("kubectl describe node k18-5")])])]),s._v(" "),n("h1",{attrs:{id:"_8-namespace"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-namespace"}},[s._v("#")]),s._v(" 8.Namespace")]),s._v(" "),n("p",[s._v("Kubernetes 支持多个虚拟集群，它们底层依赖于同一个物理集群。 这些虚拟集群被称\n为名字空间。 在一些文档里名字空间也称为命名空间。")]),s._v(" "),n("p",[n("strong",[s._v("何时使用多个名字空间")])]),s._v(" "),n("p",[s._v("名字空间适用于存在很多跨多个团队或项目的用户的场景。对于只有几到几十个用户\n的集群，根本不需要创建或考虑名字空间。当需要名称空间提供的功能时，请开始使\n用它们。\n名字空间为名称提供了一个范围。资源的名称需要在名字空间内是唯一的，但不能跨\n名字空间。 名字空间不能相互嵌套，每个 Kubernetes 资源只能在一个名字空间中。\n名字空间是在多个用户之间划分集群资源的一种方法（通过资源配额）。\n不必使用多个名字空间来分隔仅仅轻微不同的资源，例如同一软件的不同版本： 应该\n使用标签 来区分同一名字空间中的不同资源")]),s._v(" "),n("p",[n("strong",[s._v("查看名字空间")])]),s._v(" "),n("div",{staticClass:"language-aidl line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("你可以使用以下命令列出集群中现存的名字空间：\nkubectl get namespace\n\n结果\nNAME STATUS AGE\ndefault Active 1d\nkube-node-lease Active 1d\nkube-system Active 1d\nkube-public Active 1d\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[n("strong",[s._v("Kubernetes 会创建四个初始名字空间")])]),s._v(" "),n("ul",[n("li",[s._v("default 没有指明使用其它名字空间的对象所使用的默认名字空间")]),s._v(" "),n("li",[s._v("kube-system Kubernetes 系统创建对象所使用的名字空间")]),s._v(" "),n("li",[s._v("kube-public 这个名字空间是自动创建的，所有用户（包括未经过身份验证的用户）都\n可以读取它。 这个名字空间主要用于集群使用，以防某些资源在整个集群中应该是可\n见和可读的。 这个名字空间的公共方面只是一种约定，而不是要求。")]),s._v(" "),n("li",[s._v("kube-node-lease 此名字空间用于与各个节点相关的租期（Lease）对象； 此对象的设\n计使得集群规模很大时节点心跳检测性能得到提升。")])]),s._v(" "),n("p",[n("strong",[s._v("Namespace 创建")])]),s._v(" "),n("p",[n("code",[s._v("K create ns tes")])])])}),[],!1,null,null,null);e.default=t.exports}}]);